/**
 * @author npcompleto
 * @version 0.0.1a
 */(function(e,t){e.widget("mobile.hwaccordion",e.mobile.widget,{options:{theme:null,countTheme:"c",headerTheme:"b",dividerTheme:"b",splitIcon:"arrow-r",splitTheme:"b",inset:!1,timing:"800ms",autoScroll:!1,disableInput:!1,useAnimation:!0,initSelector:":jqmData(role='hwaccordion')"},_create:function(t){var n=this,r=this.element,i=this.options,s=this,o="translate"+(l?"3d(":"("),u=l?",0)":")",a=!0,f=/android 2/i.test(navigator.userAgent),l=!f&&e.support.cssTransform3d;this.options.useAnimation=l,e.mobile.activePage?this.touchOverflowScrolling=e.mobile.activePage.find(":jqmData(role='content')").css("-webkit-overflow-scrolling")=="touch":this.touchOverflowScrolling=e(":jqmData(role='content')").css("-webkit-overflow-scrolling")=="touch",this.preserve3d=!this.touchOverflowScrolling;var c="-webkit-";l&&(this.endTransitionEvent="webkitTransitionEnd"),l&&"mozAnimationStartTime"in window&&(c="-moz-",this.endTransitionEvent="transitionend");var h=r.find(":jqmData(role='accordion-element')");this.accordionElements=h;var p=r.jqmData("auto-scroll")+""=="true";p&&e.extend(this.options,[{autoScroll:r.jqmData("auto-scroll")}]);var d=r.jqmData("disable-input-on-close")+""=="true";d&&(this.options.disableInput=r.jqmData("disable-input-on-close")),l&&r.css(c+"transform","translateZ(0)"),r.addClass("ui-accordion ui-accordion-"+i.theme);var v=h.length*4,m=v,g=0;for(var y=0;y<h.length;y++){var b=e(h[y]);b.addClass("ui-accordion-element"),b.attr("accordion-index",g++),l&&b.css(c+"transition",c+"transform "+i.timing),b.jqmData("accordion-z-position",m),b.css("z-index",m),b.css("position","relative"),b.find(":jqmData(role='accordion-header'):not(.ui-accordion-header)").each(function(){$header=e(this),h[y].header=$header,$header.addClass("ui-accordion-header"),l&&$header.css(c+"transform","translateZ("+m-- +"px)"),l&&n.preserve3d&&$header.css(c+"transform-style","preserve-3d"),$header.css("z-index",m),$header.jqmData("accordion-z-position",m),$header.buttonMarkup({shadow:!1,corners:!1,iconpos:r.jqmData("iconpos")||i.iconPos||"left",icon:i.icon,mini:i.mini,theme:i.theme}),t&&$header.unbind("click"),$header.click(function(t){s._toggleAccordion(n,e(this).parent(),c)})}),b.find(":jqmData(role='accordion-content'):not(.ui-accordion-content)").each(function(){$content=e(this),h[y].content=$content,$content.addClass("ui-accordion-content"),l&&$content.css(c+"transform","translateZ("+m-- +"px)"),$content.jqmData("accordion-z-position",m),$content.css("position","relative"),$content.css("z-index",m),l&&$content.css(c+"transition",c+"transform "+i.timing),l&&n.preserve3d&&$content.css(c+"transform-style","preserve-3d")})}t||this._closeAllAccordion(n,r,c)},_translateContent:function(t,n,r,i,s,o){var u=this;if(s)r.css(n+"transition",n+"transform 0ms"),r.css(n+"transform","translateY("+i+"px) translateZ("+r.jqmData("accordion-z-position")+"px)"),o||(r.parent().hasClass("ui-accordion-closed")?r.parent().removeClass("ui-accordion-closed"):r.parent().addClass("ui-accordion-closed"));else{r.css(n+"transition",n+"transform 800ms"),r.css(n+"transform","translateY("+i+"px) translateZ("+r.jqmData("accordion-z-position")+"px)"),r.one(this.endTransitionEvent,function(){$accordion=e(this).parent(),$header=$accordion[0].header,$accordion.hasClass("ui-accordion-closing")?($accordion.removeClass("ui-accordion-closing"),$accordion.addClass("ui-accordion-closed"),e(this).css("display","none")):t.options.autoScroll===!0&&(t.touchOverflowScrolling?content.scrollTop($accordion[0].offsetTop-$header.css("margin-top").replace("px","")):e(document).scrollTop($accordion.position().top-43))}),r.css(n+"transform","translateY("+i+"px) translateZ("+r.jqmData("accordion-z-position")+"px)");var a=r.parent().attr("accordion-index");u.accordionElements.each(function(){var r=e(this).attr("accordion-index");r>a&&u._translateAccordion(t,n,e(this),i)})}},_translateAccordion:function(t,n,r,i,s){s?(r.css(n+"transition",n+"transform 0ms"),e(this).css(n+"transform","translateY(0)")):(r.css(n+"transition",n+"transform 800ms"),r.css(n+"transform","translateY("+i+"px) translateZ("+r.jqmData("accordion-z-position")+"px)"),r.one(this.endTransitionEvent,function(){e(this).css(n+"transition",n+"transform 0ms"),e(this).css(n+"transform","translateY(0)")}))},_closeAccordion:function(e,t,n,r,i){var s=this;r||t.addClass("ui-accordion-closing"),s.options.disableInput&&t.find("input, textarea").attr("disabled","disabled");if(this.options.useAnimation){var o=t[0].content;if(o){var u=-(Number(o.height())+Number(o.css("padding-top").replace("px",""))+Number(o.css("padding-bottom").replace("px","")));s._translateContent(e,n,o,u,r,i)}}else{t.removeClass("ui-accordion-closing").addClass("ui-accordion-closed");var o=t[0].content;o&&o.css("display","none")}},_closeAllAccordion:function(t,n,r,i){var s=this;s.accordionElements.each(function(){$accordion=e(this),s._closeAccordion(t,$accordion,r,!0,i)})},_openAccordion:function(t,n,r){var i=this,s=n.parent();i._closeAccordion(t,n,r,!0,!0),i.options.disableInput&&n.find("input, textarea").removeAttr("disabled");var o=s.jqmData("one-at-a-time");o&&s.find(".ui-accordion-element:not(.ui-accordion-closed)").each(function(){i._closeAccordion(t,e(this),r,!0)}),n.removeClass("ui-accordion-closed").removeClass("ui-accordion-closing");if(this.options.useAnimation){var u=n[0].content;u&&(u.css("display","block"),setTimeout(function(){i._translateContent(t,r,u,"0")},0))}else{t.options.autoScroll===!0&&e(document).scrollTop(n[0].header.position().top-43);var u=n[0].content;u&&u.css("display","block")}},_toggleAccordion:function(e,t,n){var r=this;t.hasClass("ui-accordion-closed")?r._openAccordion(e,t,n):r._closeAccordion(e,t,n)},refresh:function(e){this._create(!0)},disableAll:function(t){e(this.element[0]).find("input, textarea").attr("disabled","disabled")},open:function(n){this.accordionElements[n]&&this._openAccordion(this,e(this.accordionElements[n]),"-webkit-",t)},close:function(n){this.accordionElements[n]&&this._closeAccordion(this,e(this.accordionElements[n]),"-webkit-",t)}}),e(document).bind("pagecreate create",function(t){e.mobile.hwaccordion.prototype.enhanceWithin(t.target)})})(jQuery);